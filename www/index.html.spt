from gittip.models import community
[---]
participant = user.participant # for team listing
communities = [c for c in community.get_list_for(website.db, user.participant.username) if c.is_member]
def with_others(obj):
    others = obj.nmembers - 1
    return _(("with {n} other", "with {n} others"), n=others)


friends_hack = website.db.all("""

    SELECT username
         , claimed_time
         , avatar_url
         , statement
         , number
      FROM participants
     WHERE claimed_time IS NOT NULL
       AND is_suspicious IS NOT TRUE
  ORDER BY claimed_time DESC
     LIMIT 9

""")


[---]
{% from 'templates/avatar-url.html' import avatar_url with context %}
{% extends "templates/base.html" %}
{% block head %}
    <link rel="publisher" href="https://plus.google.com/110591317655791133884">
    <meta name="description" content="Weekly payments, motivated by gratitude. Sustainably crowdfund your business, personal projects, or charity, with no extra fees." />
    <meta name="fb:app_id" content="229465400522758" />
    <meta name="og:type" content="website" />
    <meta name="og:url" content="https://www.gittip.com/" />
    <meta name="og:title" content="Gittip" />
    <meta name="og:image" content="{{ website.asset_url }}/gittip.opengraph.png" />
{% endblock %}

{% block heading %}
{% if user.ANON %}{% else %}{{ super() }}{% endif %}
{% endblock %}
{% block whole_page %}
{% if user.ANON %}
<style>
    .pennies, .container { display: none; }
    #upgrade_browser .container { display: block; }
    html, body { height: 100%; min-height: 100%; }
</style>
<div class="homepage">
    <div class="pitch">
        <img src="{{ website.asset_url }}/logo.white.svg" alt="Gittip">
        <h1>{{ _("Weekly Payments") }}</h1>
        <p>{{ _("Motivated by Gratitude") }}</p>

        <p>{{ _("Sustainably crowdfund your business, personal projects, or charity with voluntary payments.",
            "<span>", "</span>") }}</p>

        <p><a href="/about/">{{ _("Learn more.") }}</a></p>

    </div>
    <div class="action">
        {{ _("{0}Sign In{1} {2}to Accept Weekly Payments{3}",
            "<h1>", "</h1>", "<p>", "</p>") }}
        {% from 'templates/auth.html' import auth_button with context %}

        <div class="twitter">
        {% call auth_button('twitter', 'opt-in') %}
        {{ _("Sign in with {0}", "Twitter") }}
        {% endcall %}
        </div>

        <div class="other">{{ _("Or sign in with:") }}
        <span>
        {% call auth_button('github', 'opt-in') %}GitHub{% endcall %}
        {% call auth_button('bitbucket', 'opt-in') %}Bitbucket{% endcall %}
        {% call auth_button('openstreetmap', 'opt-in') %}OpenStreetMap{% endcall %}
        </span></div>

        <p class="other">{{
            _("By signing in, you indicate that you have read and agree to our {0}Terms and Conditions{1}.",
                "<a href='/about/terms/'>", "</a>") + " " +
            _("You'll be joining {0} active users, who exchanged {1} {2}last week{3}.",
                format_number(website.gnactive),
                format_currency(website.gtransfer_volume, "USD"),
                "<a href='/about/charts.html'>", "</a>") + " " +
            _("Want to see who they are? Browse {0}our communities{1}.",
                "<a href='/for/'>", "</a>") + " " +
            _("Want to work for Gittip? We are an {0}open company{1}.",
                "<a href='http://building.gittip.com/big-picture/welcome'>", "</a>") }}</p>
    </div>
</div>
{% else %}
<div class="container">
    <div id="page" class="group">
        {% block page %}
        <div class="col0">

            <h2>Giving $0 per Week</h2>

            <p>Let's play the giving game! Click your Twitter friends to give
            them a quarter a week!</p>

            <div class="people">
                <ul class="group">
                    {% for i, participant in enumerate(friends_hack, start=1) %}
                    <li>
                        <a href="/{{ participant.username }}/" class="mini-user tip">
                            <span class="inner">
                                <span class="avatar"
                                    style="background-image: url('{{ avatar_url(participant) }}')">
                                </span>
                                <span class="name">{{ participant.username }}</span>
                            </span>
                        </a>
                    </li>
                    {% endfor %}
                </ul>
            </div>


            <div class="clear"></div>
            <h2>Receiving $0 per Week</h2>

            <p>To receive money, do something awesome and then tell people
            about it! Fill out <a href="">your profile</a> and see our <a
            href="">About Receiving</a> guide for more suggestions.</p>


            {% include "templates/team-listing.html" %}

            <p><a href="">Join Teams</a> | <a href="">What are Teams?</a></p>


            {% include "templates/community-listing.html" %}

            <p><a href="">Join Communities</a> | <a href="">What are Communities?</a></p>


        </div>
        {% endblock %}
    </div>
</div>
{% endif %}
{% endblock %}
